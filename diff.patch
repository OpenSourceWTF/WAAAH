diff --git a/packages/mcp-server/tests/agent-matcher.test.ts b/packages/mcp-server/tests/agent-matcher.test.ts
new file mode 100644
index 0000000..9b0ebc7
--- /dev/null
+++ b/packages/mcp-server/tests/agent-matcher.test.ts
@@ -0,0 +1,174 @@
+
+import { describe, it, expect, vi, beforeEach } from 'vitest';
+import { 
+  scoreAgent, 
+  findBestAgent, 
+  findPendingTaskForAgent, 
+  findAndReserveAgent,
+  waitForTask,
+  SCHEDULER_CONFIG,
+  WaitingAgent
+} from '../src/state/agent-matcher.js';
+import { Task, StandardCapability } from '@opensourcewtf/waaah-types';
+
+describe('Agent Matcher', () => {
+  const mockTask = (overrides: Partial<Task> = {}): Task => ({
+    id: 'task-1',
+    status: 'QUEUED',
+    command: 'test',
+    prompt: 'test',
+    priority: 'normal',
+    from: { type: 'agent', id: 'source' },
+    to: { agentId: undefined, requiredCapabilities: [] },
+    context: {},
+    createdAt: 1000,
+    ...overrides
+  } as Task);
+
+  const mockAgent = (id: string, caps: StandardCapability[], waitingSince: number = 1000): WaitingAgent => ({
+    agentId: id,
+    capabilities: caps,
+    waitingSince
+  });
+
+  describe('scoreAgent', () => {
+    it('should score 1.0 for perfect match', () => {
+      const task = mockTask({ 
+        to: { requiredCapabilities: ['code-writing'], workspaceId: 'repo-1', agentId: 'agent-1' } 
+      });
+      const agent: WaitingAgent = {
+        agentId: 'agent-1',
+        capabilities: ['code-writing'],
+        workspaceContext: { type: 'local', repoId: 'repo-1' },
+        waitingSince: 1000
+      };
+
+      const result = scoreAgent(task, agent);
+      expect(result.score).toBe(1.0);
+      expect(result.eligible).toBe(true);
+    });
+
+    it('should score 0.0 if capabilities missing', () => {
+      const task = mockTask({ to: { requiredCapabilities: ['code-writing'] } });
+      const agent = mockAgent('agent-1', []);
+
+      const result = scoreAgent(task, agent);
+      expect(result.score).toBe(0.0);
+      expect(result.eligible).toBe(false);
+    });
+
+    it('should handle neutral scores', () => {
+      const task = mockTask(); // No requirements
+      const agent = mockAgent('agent-1', ['code-writing']);
+
+      const result = scoreAgent(task, agent);
+      // Weights: ws(0.4)*0.5 + caps(0.4)*1.0 + hint(0.2)*0.5 = 0.2 + 0.4 + 0.1 = 0.7
+      expect(result.score).toBeCloseTo(0.7);
+      expect(result.eligible).toBe(true);
+    });
+  });
+
+  describe('findBestAgent', () => {
+    it('should select highest scoring agent', () => {
+      const task = mockTask({ to: { requiredCapabilities: ['code-writing'] } });
+      const a1 = mockAgent('a1', ['code-writing']); // Neutral score
+      const a2 = mockAgent('a2', ['code-writing']); 
+      
+      // Give a2 a workspace match to boost score
+      a2.workspaceContext = { type: 'local', repoId: 'repo-1' };
+      task.to.workspaceId = 'repo-1';
+
+      const result = findBestAgent(task, [a1, a2]);
+      expect(result?.agentId).toBe('a2');
+    });
+
+    it('should use waitingSince as tiebreaker', () => {
+      const task = mockTask();
+      const a1 = mockAgent('a1', [], 2000); // Newer
+      const a2 = mockAgent('a2', [], 1000); // Older
+
+      const result = findBestAgent(task, [a1, a2]);
+      expect(result?.agentId).toBe('a2');
+    });
+  });
+
+  describe('findPendingTaskForAgent', () => {
+    let mockQueue: any;
+
+    beforeEach(() => {
+      mockQueue = {
+        getByStatuses: vi.fn(),
+        updateStatus: vi.fn(),
+        pendingAcks: new Map()
+      };
+    });
+
+    it('should return first eligible task', () => {
+      const t1 = mockTask({ id: 't1', to: { requiredCapabilities: ['test-writing'] } });
+      const t2 = mockTask({ id: 't2', to: { requiredCapabilities: ['code-writing'] } });
+      mockQueue.getByStatuses.mockReturnValue([t1, t2]);
+
+      const result = findPendingTaskForAgent(mockQueue, 'a1', ['code-writing']);
+      expect(result?.id).toBe('t2');
+    });
+
+    it('should respect dependencies', () => {
+      const t1 = mockTask({ 
+        id: 't1', 
+        dependencies: ['dep-1'],
+        to: { requiredCapabilities: [] } 
+      });
+      mockQueue.getByStatuses.mockReturnValue([t1]);
+
+      // dep-1 not completed
+      const getTask = vi.fn().mockReturnValue({ status: 'IN_PROGRESS' });
+      
+      const result = findPendingTaskForAgent(mockQueue, 'a1', [], undefined, getTask);
+      expect(result).toBeUndefined();
+    });
+  });
+
+  describe('waitForTask', () => {
+    let mockQueue: any;
+
+    beforeEach(() => {
+      mockQueue = {
+        popEviction: vi.fn(),
+        addWaitingAgent: vi.fn(),
+        removeWaitingAgent: vi.fn(),
+        getByStatuses: vi.fn().mockReturnValue([]),
+        pendingAcks: new Map(),
+        updateStatus: vi.fn(),
+        on: vi.fn(),
+        off: vi.fn()
+      };
+    });
+
+    it('should resolve immediately if pending task found', async () => {
+      const task = mockTask();
+      mockQueue.getByStatuses.mockReturnValue([task]);
+
+      const result = await waitForTask(mockQueue, 'a1', []);
+      expect((result as Task).id).toBe('task-1');
+      expect(mockQueue.updateStatus).toHaveBeenCalledWith('task-1', 'PENDING_ACK');
+    });
+
+    it('should wait for event if no task', async () => {
+      // Setup promise to simulate event emission
+      let taskListener: any;
+      mockQueue.on.mockImplementation((event: string, cb: any) => {
+        if (event === 'task') taskListener = cb;
+      });
+
+      const promise = waitForTask(mockQueue, 'a1', [], undefined, 100);
+      
+      // Simulate event
+      setTimeout(() => {
+        if (taskListener) taskListener(mockTask(), 'a1');
+      }, 10);
+
+      const result = await promise;
+      expect((result as Task).id).toBe('task-1');
+    });
+  });
+});
diff --git a/packages/mcp-server/tests/api_verification.test.ts b/packages/mcp-server/tests/api_verification.test.ts
index 071f241..be2a9c5 100644
--- a/packages/mcp-server/tests/api_verification.test.ts
+++ b/packages/mcp-server/tests/api_verification.test.ts
@@ -105,9 +105,11 @@ describe('API Verification: Activity Feed & Controls', () => {
     if (server) server.close();
   });
 
+  const API_KEY = 'test-api-key-12345';
+
   describe('GET /admin/logs', () => {
     it('should return a list of logs', async () => {
-      const res = await request(app).get('/admin/logs');
+      const res = await request(app).get('/admin/logs').set('x-api-key', API_KEY);
       expect(res.status).toBe(200);
       expect(Array.isArray(res.body)).toBe(true);
       expect(res.body.length).toBe(2);
@@ -117,13 +119,13 @@ describe('API Verification: Activity Feed & Controls', () => {
 
   describe('POST /admin/tasks/:taskId/cancel', () => {
     it('should cancel a queued task', async () => {
-      const res = await request(app).post('/admin/tasks/task-queued/cancel');
+      const res = await request(app).post('/admin/tasks/task-queued/cancel').set('x-api-key', API_KEY);
       expect(res.status).toBe(200);
       expect(res.body.success).toBe(true);
     });
 
     it('should fail to cancel a completed task', async () => {
-      const res = await request(app).post('/admin/tasks/task-completed/cancel');
+      const res = await request(app).post('/admin/tasks/task-completed/cancel').set('x-api-key', API_KEY);
       expect(res.status).toBe(400);
       expect(res.body.error).toBe('Cannot cancel completed task');
     });
@@ -133,6 +135,7 @@ describe('API Verification: Activity Feed & Controls', () => {
     it('should queue eviction for an agent', async () => {
       const res = await request(app)
         .post('/admin/evict')
+        .set('x-api-key', API_KEY)
         .send({ agentId: 'agent-1', reason: 'Test' });
 
       expect(res.status).toBe(200);
@@ -141,7 +144,7 @@ describe('API Verification: Activity Feed & Controls', () => {
     });
 
     it('should validate missing agentId', async () => {
-      const res = await request(app).post('/admin/evict').send({ reason: 'Test' });
+      const res = await request(app).post('/admin/evict').set('x-api-key', API_KEY).send({ reason: 'Test' });
       expect(res.status).toBe(400);
     });
   });
@@ -150,6 +153,7 @@ describe('API Verification: Activity Feed & Controls', () => {
     it('should request eviction for known agent', async () => {
       const res = await request(app)
         .post('/admin/agents/agent-1/evict')
+        .set('x-api-key', API_KEY)
         .send({ reason: 'Test' });
 
       expect(res.status).toBe(200);
@@ -159,6 +163,7 @@ describe('API Verification: Activity Feed & Controls', () => {
     it('should return 404 for unknown agent', async () => {
       const res = await request(app)
         .post('/admin/agents/unknown-agent/evict')
+        .set('x-api-key', API_KEY)
         .send({ reason: 'Test' });
 
       expect(res.status).toBe(404);
